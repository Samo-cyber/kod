"use strict";(()=>{var e={};e.id=92,e.ids=[92],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1867:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>w,patchFetch:()=>_,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>b});var r={};a.r(r),a.d(r,{GET:()=>d,POST:()=>l});var s=a(9303),i=a(8716),n=a(670),o=a(7070),u=a(9487);async function d(e){let{searchParams:t}=new URL(e.url),a=parseInt(t.get("page")||"1"),r=parseInt(t.get("limit")||"20"),s=t.get("status")||void 0;try{await u.db.connect();let e=await u.db.getStories({status:s,page:a,limit:r});return o.NextResponse.json(e)}catch(e){return o.NextResponse.json({error:"Internal Server Error"},{status:500})}}async function l(e){try{let t=await e.json();await u.db.connect();let a=await u.db.createStory({...t,slug:t.slug||t.title_ar.toLowerCase().replace(/ /g,"-")});return o.NextResponse.json(a)}catch(e){return o.NextResponse.json({error:"Internal Server Error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/stories/route",pathname:"/api/admin/stories",filename:"route",bundlePath:"app/api/admin/stories/route"},resolvedPagePath:"D:\\Projects\\Git Local\\kod\\app\\api\\admin\\stories\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:b,serverHooks:h}=p,w="/api/admin/stories/route";function _(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:b})}},9487:(e,t,a)=>{a.d(t,{db:()=>i});var r=a(5674);class s{constructor(){let e=process.env.SUPABASE_URL||"https://jumuwymzngswknsoizdb.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1bXV3eW16bmdzd2tuc29pemRiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNDg2MzMsImV4cCI6MjA3OTkyNDYzM30.4osfj8bUa4Ckw5gAPRY0hZ-MbQjodKS_Tg9GMs3B3B4";if(!e||!t)throw Error("Missing Supabase environment variables");this.supabase=(0,r.eI)(e,t)}async connect(){}async getStories(e){let t=e?.page||1,a=e?.limit||10,r=(t-1)*a,s=this.supabase.from("Story").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(r,r+a-1);e?.status&&(s=s.eq("status",e.status));let{data:i,error:n,count:o}=await s;if(n)throw n;return{data:i?.map(e=>({...e,created_at:new Date(e.created_at),updated_at:new Date(e.updated_at),publish_date:e.publish_date?new Date(e.publish_date):null}))||[],meta:{total:o||0,page:t,limit:a}}}async getStoryBySlug(e){let{data:t,error:a}=await this.supabase.from("Story").select("*").eq("slug",e).single();return a?null:{...t,created_at:new Date(t.created_at),updated_at:new Date(t.updated_at),publish_date:t.publish_date?new Date(t.publish_date):null}}async getStoryById(e){let{data:t,error:a}=await this.supabase.from("Story").select("*").eq("id",e).single();return a?null:{...t,created_at:new Date(t.created_at),updated_at:new Date(t.updated_at),publish_date:t.publish_date?new Date(t.publish_date):null}}async createStory(e){let t=Object.fromEntries(Object.entries(e).filter(([e,t])=>void 0!==t)),{data:a,error:r}=await this.supabase.from("Story").insert(t).select().single();if(r)throw r;return{...a,created_at:new Date(a.created_at),updated_at:new Date(a.updated_at),publish_date:a.publish_date?new Date(a.publish_date):null}}async updateStory(e,t){let a=Object.fromEntries(Object.entries(t).filter(([e,t])=>void 0!==t)),{data:r,error:s}=await this.supabase.from("Story").update(a).eq("id",e).select().single();if(s)throw s;return{...r,created_at:new Date(r.created_at),updated_at:new Date(r.updated_at),publish_date:r.publish_date?new Date(r.publish_date):null}}async deleteStory(e){let{error:t}=await this.supabase.from("Story").delete().eq("id",e);if(t)throw t}async uploadMedia(e){let t=`${Date.now()}-${e.name}`,{data:a,error:r}=await this.supabase.storage.from("media").upload(t,e);if(r)throw r;let{data:{publicUrl:s}}=this.supabase.storage.from("media").getPublicUrl(t);return{path:a.path,url:s}}async listMedia(e){let{data:t,error:a}=await this.supabase.from("Media").select("*");return a?[]:t.map(e=>({...e,uploaded_at:new Date(e.uploaded_at)}))}}let i=new s}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,674,972],()=>a(1867));module.exports=r})();