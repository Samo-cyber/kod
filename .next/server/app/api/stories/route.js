"use strict";(()=>{var t={};t.id=655,t.ids=[655],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1215:(t,e,a)=>{a.r(e),a.d(e,{originalPathname:()=>w,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>o,serverHooks:()=>h,staticGenerationAsyncStorage:()=>c});var r={};a.r(r),a.d(r,{GET:()=>d});var i=a(9303),s=a(8716),n=a(670),l=a(7070),u=a(9487);async function d(t){let{searchParams:e}=new URL(t.url),a=parseInt(e.get("page")||"1"),r=parseInt(e.get("limit")||"12");try{await u.db.connect();let t=await u.db.getStories({status:"published",page:a,limit:r});return l.NextResponse.json(t)}catch(t){return console.error("Failed to fetch stories:",t),l.NextResponse.json({error:"Internal Server Error"},{status:500})}}let o=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/stories/route",pathname:"/api/stories",filename:"route",bundlePath:"app/api/stories/route"},resolvedPagePath:"D:\\Projects\\Git Local\\kod\\app\\api\\stories\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:h}=o,w="/api/stories/route";function _(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:c})}},9487:(t,e,a)=>{a.d(e,{db:()=>i});class r{constructor(){this.supabase=null,this.url="https://jumuwymzngswknsoizdb.supabase.co",this.key=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1bXV3eW16bmdzd2tuc29pemRiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNDg2MzMsImV4cCI6MjA3OTkyNDYzM30.4osfj8bUa4Ckw5gAPRY0hZ-MbQjodKS_Tg9GMs3B3B4"}async getClient(){if(!this.url||!this.key)return null;if(this.supabase)return this.supabase;let{createClient:t}=await a.e(674).then(a.bind(a,5674));return this.supabase=t(this.url,this.key,{auth:{persistSession:!1}}),this.supabase}async connect(){await this.getClient()}async getStories(t){let e=await this.getClient();if(!e)throw Error("Supabase not configured");let a=t?.page||1,r=t?.limit||10,i=(a-1)*r,s=e.from("Story").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(i,i+r-1);t?.status&&(s=s.eq("status",t.status));let{data:n,error:l,count:u}=await s;if(l)throw l;return{data:(n||[]).map(t=>({...t,created_at:t.created_at?new Date(t.created_at):null,updated_at:t.updated_at?new Date(t.updated_at):null,publish_date:t.publish_date?new Date(t.publish_date):null})),meta:{total:u||0,page:a,limit:r}}}async getStoryBySlug(t){let e=await this.getClient();if(!e)return null;let{data:a,error:r}=await e.from("Story").select("*").eq("slug",t).single();return r?null:{...a,created_at:a.created_at?new Date(a.created_at):null,updated_at:a.updated_at?new Date(a.updated_at):null,publish_date:a.publish_date?new Date(a.publish_date):null}}async getStoryById(t){let e=await this.getClient();if(!e)return null;let{data:a,error:r}=await e.from("Story").select("*").eq("id",t).single();return r?null:{...a,created_at:a.created_at?new Date(a.created_at):null,updated_at:a.updated_at?new Date(a.updated_at):null,publish_date:a.publish_date?new Date(a.publish_date):null}}async createStory(t){let e=await this.getClient();if(!e)throw Error("Supabase not configured");let a=Object.fromEntries(Object.entries(t).filter(([t,e])=>void 0!==e)),{data:r,error:i}=await e.from("Story").insert(a).select().single();if(i)throw i;return{...r,created_at:r.created_at?new Date(r.created_at):null,updated_at:r.updated_at?new Date(r.updated_at):null,publish_date:r.publish_date?new Date(r.publish_date):null}}async updateStory(t,e){let a=await this.getClient();if(!a)throw Error("Supabase not configured");let r=Object.fromEntries(Object.entries(e).filter(([t,e])=>void 0!==e)),{data:i,error:s}=await a.from("Story").update(r).eq("id",t).select().single();if(s)throw s;return{...i,created_at:i.created_at?new Date(i.created_at):null,updated_at:i.updated_at?new Date(i.updated_at):null,publish_date:i.publish_date?new Date(i.publish_date):null}}async deleteStory(t){let e=await this.getClient();if(!e)throw Error("Supabase not configured");let{error:a}=await e.from("Story").delete().eq("id",t);if(a)throw a}async uploadMedia(t){let e=await this.getClient();if(!e)throw Error("Supabase not configured");let a=`${Date.now()}-${t&&t.name||"upload"}`,r=t.buffer??t,{data:i,error:s}=await e.storage.from("media").upload(a,r,{cacheControl:"3600",upsert:!1});if(s)throw s;let{data:n}=e.storage.from("media").getPublicUrl(i.path);return{path:i.path,url:n.publicUrl}}async listMedia(t){let e=await this.getClient();if(!e)return[];let{data:a,error:r}=await e.from("Media").select("*");return r?[]:(a||[]).map(t=>({...t,uploaded_at:t.uploaded_at?new Date(t.uploaded_at):null}))}}let i=new r}};var e=require("../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),r=e.X(0,[276,972],()=>a(1215));module.exports=r})();