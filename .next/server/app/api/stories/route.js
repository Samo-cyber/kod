"use strict";(()=>{var e={};e.id=655,e.ids=[655],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1215:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>b,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>c});var s={};a.r(s),a.d(s,{GET:()=>d});var r=a(9303),i=a(8716),n=a(670),o=a(7070),u=a(9487);async function d(e){let{searchParams:t}=new URL(e.url),a=parseInt(t.get("page")||"1"),s=parseInt(t.get("limit")||"12");try{await u.db.connect();let e=await u.db.getStories({status:"published",page:a,limit:s});return o.NextResponse.json(e)}catch(e){return console.error("Failed to fetch stories:",e),o.NextResponse.json({error:"Internal Server Error"},{status:500})}}let l=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/stories/route",pathname:"/api/stories",filename:"route",bundlePath:"app/api/stories/route"},resolvedPagePath:"D:\\Projects\\Git Local\\kod\\app\\api\\stories\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:h}=l,b="/api/stories/route";function _(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:c})}},9487:(e,t,a)=>{a.d(t,{db:()=>i});var s=a(5674);class r{constructor(){let e=process.env.SUPABASE_URL||"https://jumuwymzngswknsoizdb.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1bXV3eW16bmdzd2tuc29pemRiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNDg2MzMsImV4cCI6MjA3OTkyNDYzM30.4osfj8bUa4Ckw5gAPRY0hZ-MbQjodKS_Tg9GMs3B3B4";if(!e||!t)throw Error("Missing Supabase environment variables");this.supabase=(0,s.eI)(e,t)}async connect(){}async getStories(e){let t=e?.page||1,a=e?.limit||10,s=(t-1)*a,r=this.supabase.from("Story").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(s,s+a-1);e?.status&&(r=r.eq("status",e.status));let{data:i,error:n,count:o}=await r;if(n)throw n;return{data:i?.map(e=>({...e,created_at:new Date(e.created_at),updated_at:new Date(e.updated_at),publish_date:e.publish_date?new Date(e.publish_date):null}))||[],meta:{total:o||0,page:t,limit:a}}}async getStoryBySlug(e){let{data:t,error:a}=await this.supabase.from("Story").select("*").eq("slug",e).single();return a?null:{...t,created_at:new Date(t.created_at),updated_at:new Date(t.updated_at),publish_date:t.publish_date?new Date(t.publish_date):null}}async getStoryById(e){let{data:t,error:a}=await this.supabase.from("Story").select("*").eq("id",e).single();return a?null:{...t,created_at:new Date(t.created_at),updated_at:new Date(t.updated_at),publish_date:t.publish_date?new Date(t.publish_date):null}}async createStory(e){let t=Object.fromEntries(Object.entries(e).filter(([e,t])=>void 0!==t)),{data:a,error:s}=await this.supabase.from("Story").insert(t).select().single();if(s)throw s;return{...a,created_at:new Date(a.created_at),updated_at:new Date(a.updated_at),publish_date:a.publish_date?new Date(a.publish_date):null}}async updateStory(e,t){let a=Object.fromEntries(Object.entries(t).filter(([e,t])=>void 0!==t)),{data:s,error:r}=await this.supabase.from("Story").update(a).eq("id",e).select().single();if(r)throw r;return{...s,created_at:new Date(s.created_at),updated_at:new Date(s.updated_at),publish_date:s.publish_date?new Date(s.publish_date):null}}async deleteStory(e){let{error:t}=await this.supabase.from("Story").delete().eq("id",e);if(t)throw t}async uploadMedia(e){let t=`${Date.now()}-${e.name}`,{data:a,error:s}=await this.supabase.storage.from("media").upload(t,e);if(s)throw s;let{data:{publicUrl:r}}=this.supabase.storage.from("media").getPublicUrl(t);return{path:a.path,url:r}}async listMedia(e){let{data:t,error:a}=await this.supabase.from("Media").select("*");return a?[]:t.map(e=>({...e,uploaded_at:new Date(e.uploaded_at)}))}}let i=new r}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[276,674,972],()=>a(1215));module.exports=s})();